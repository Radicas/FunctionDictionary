# 版本控制规范

## 1. 版本号格式

本项目采用语义化版本控制(Semantic Versioning)规范，版本号格式为：

```
a.b.c[-preRelease][+buildMetadata]
```

其中：
- `a`：主版本号，在进行不兼容的API更改时递增
- `b`：次版本号，在添加向后兼容的功能时递增
- `c`：修订号，在进行向后兼容的问题修复时递增
- `preRelease`：可选的预发布版本标识符，格式为连字符后跟点分隔的标识符
- `buildMetadata`：可选的构建元数据，格式为加号后跟点分隔的标识符

## 2. 版本号递增规则

### 2.1 主版本号 (Major)
- 当进行不兼容的API更改时递增
- 递增主版本号时，次版本号和修订号必须重置为0

### 2.2 次版本号 (Minor)
- 当添加向后兼容的新功能时递增
- 递增次版本号时，修订号必须重置为0

### 2.3 修订号 (Patch)
- 当进行向后兼容的问题修复时递增

## 3. 预发布版本

- 预发布版本用于发布候选版本、测试版本等
- 格式为：`a.b.c-标识符`，例如 `1.0.0-beta`、`2.0.0-alpha.1`
- 预发布版本的优先级低于对应的正式版本，例如 `1.0.0-beta` < `1.0.0`

## 4. 构建元数据

- 构建元数据用于标识构建信息，如构建时间、构建环境等
- 格式为：`a.b.c+元数据`，例如 `1.0.0+20260228`、`2.0.0+linux.x64`
- 构建元数据不参与版本比较

## 5. 版本比较规则

1. 首先比较主版本号，主版本号大的版本优先级高
2. 如果主版本号相同，比较次版本号，次版本号大的版本优先级高
3. 如果次版本号相同，比较修订号，修订号大的版本优先级高
4. 如果核心版本号相同，没有预发布标识符的版本优先级高于有预发布标识符的版本
5. 如果都有预发布标识符，则按字典序比较预发布标识符
6. 构建元数据不参与版本比较

## 6. 版本号使用规范

- 版本号必须从 `0.1.0` 开始，而不是 `0.0.1`
- 当项目处于初始开发阶段，主版本号应为 `0`
- 当项目达到稳定状态，应发布 `1.0.0` 版本
- 后续版本应根据API兼容性和功能变更遵循语义化版本规范

## 7. 实现细节

项目中通过 `VersionManager` 类实现版本号的管理，位于 `src/common/utils/` 目录下：

- `versionmanager.h`：定义了 `VersionManager` 类的接口
- `VersionManager.cpp`：实现了 `VersionManager` 类的具体功能

### 7.1 主要功能

- 版本号的解析与验证
- 版本号的递增操作
- 版本号的比较操作
- 版本号的字符串表示

### 7.2 使用示例

```cpp
// 初始化版本号
VersionManager version(1, 0, 0);

// 递增次版本号
version.incrementMinor(); // 变为 1.1.0

// 设置预发布版本
version.setPreRelease("beta"); // 变为 1.1.0-beta

// 比较版本号
VersionManager v1(1, 0, 0);
VersionManager v2(1, 0, 1);
if (v1 < v2) {
    // v1 小于 v2
}

// 转换为字符串
std::string versionStr = version.toString(); // "1.1.0-beta"
```

## 8. 版本控制工作流程

1. 开发新功能时，递增次版本号
2. 修复bug时，递增修订号
3. 进行不兼容更改时，递增主版本号
4. 在发布前，可以使用预发布版本进行测试
5. 发布正式版本时，移除预发布标识符
6. 每次发布时，更新版本号并记录在发布说明中

## 9. 版本号存储

- 项目的当前版本号应存储在代码中，便于程序运行时获取
- 版本号变更应在代码提交时明确记录在提交信息中
- 发布版本时，应在发布说明中详细记录版本变更内容

## 10. 总结

本规范遵循语义化版本控制(Semantic Versioning) 2.0.0 标准，旨在提供清晰、一致的版本号管理方式，便于项目的维护和升级。